<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{appointment.schedule}">Schedule Appointment - Healthcare Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #5bc0de;
            --success-color: #5cb85c;
            --warning-color: #f0ad4e;
            --danger-color: #d9534f;
            --light-bg: #f8f9fa;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sidebar {
            background: white;
            min-height: calc(100vh - 56px);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            padding: 0;
        }

        .sidebar-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar-item:hover {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
        }

        .sidebar-item.active {
            background-color: var(--primary-color);
            color: white;
        }

        .schedule-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            background: white;
            border-left: 5px solid var(--primary-color);
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 500;
        }

        .btn-outline-secondary {
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 500;
        }

        .patient-search-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .patient-search-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-left: 4px solid var(--primary-color);
        }

        .patient-search-card.selected {
            border-left: 4px solid var(--success-color);
            background-color: #f8fff8;
        }

        .patient-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .time-slot {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .time-slot:hover {
            border-color: var(--primary-color);
            background-color: #f8f9fa;
        }

        .time-slot.selected {
            border-color: var(--success-color);
            background-color: var(--success-color);
            color: white;
        }

        .time-slot.unavailable {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .section-header {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #e9ecef;
            z-index: 1;
        }

        .step:last-child::after {
            display: none;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e9ecef;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            margin-bottom: 5px;
        }

        .step.active .step-circle {
            background-color: var(--primary-color);
            color: white;
        }

        .step.completed .step-circle {
            background-color: var(--success-color);
            color: white;
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: white;
        }
    </style>
</head>
<body th:attr="data-success-text=#{common.success}, data-scheduled-text=#{appointment.scheduled.successfully}">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-user-md me-2"></i>
                <span th:text="#{main.title} + ' - ' + #{doctor.title}">Healthcare Portal - Doctor</span>
            </a>
            <button title="#{common.menu}" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" th:title="#{common.menu}">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item me-3">
                        <div th:replace="~{fragments/language-selector :: language-selector}"></div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span th:text="${doctor != null ? ('Dr. ' + doctor.firstName + ' ' + doctor.lastName) : 'Dr. Guest'}">Dr. Sarah Johnson</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/doctor-profile"><i class="fas fa-user me-2"></i><span th:text="#{dashboard.profile}">Profile</span></a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i><span th:text="#{common.settings}">Settings</span></a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i><span th:text="#{dashboard.logout}">Logout</span></a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 p-0">
                <div class="sidebar">
                    <div class="sidebar-item" onclick="window.location.href='/doctor-dashboard'">
                        <i class="fas fa-tachometer-alt me-3"></i><span th:text="#{dashboard.title}">Dashboard</span>
                    </div>
                    <div class="sidebar-item active" onclick="window.location.href='/doctor-appointments'">
                        <i class="fas fa-calendar-alt me-3"></i><span th:text="#{dashboard.appointments}">Appointments</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='/patient-management'">
                        <i class="fas fa-users me-3"></i><span th:text="#{patient.management.title}">Patient Management</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='/medical-records'">
                        <i class="fas fa-file-medical me-3"></i><span th:text="#{medical.records.title}">Medical Records</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='/doctor-prescriptions'">
                        <i class="fas fa-prescription-bottle me-3"></i><span th:text="#{dashboard.prescriptions}">Prescriptions</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='/doctor-billing'">
                        <i class="fas fa-credit-card me-3"></i><span th:text="#{billing.title}">Billing</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='/analytics'">
                        <i class="fas fa-chart-bar me-3"></i><span th:text="#{analytics.title}">Analytics</span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- Page Header -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-0">
                                    <i class="fas fa-calendar-plus text-primary me-2"></i>
                                    <span th:text="#{appointment.schedule.new}">Schedule New Appointment</span>
                                </h2>
                                <p class="text-muted mb-0" th:text="#{appointment.create.new.description}">Create a new appointment for your patient</p>
                            </div>
                            <a href="/doctor-appointments" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i><span th:text="#{appointment.back.to.appointments}">Back to Appointments</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active" id="step1">
                        <div class="step-circle">1</div>
                        <small th:text="#{appointment.patient.selection}">Patient Selection</small>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-circle">2</div>
                        <small th:text="#{appointment.date.time}">Date & Time</small>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-circle">3</div>
                        <small th:text="#{appointment.details}">Details</small>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-circle">4</div>
                        <small th:text="#{appointment.confirmation}">Confirmation</small>
                    </div>
                </div>

                <!-- Schedule Form -->
                <div class="schedule-card card">
                    <div class="card-body p-4">
                        <form id="scheduleForm">
                            <!-- Step 1: Patient Selection -->
                            <div id="patientStep" class="form-step">
                                <h4 class="section-header">
                                    <i class="fas fa-user-plus me-2"></i><span th:text="#{appointment.select.patient}">Select Patient</span>
                                </h4>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="patientSearch" class="form-label" th:text="#{appointment.search.for.patient}">Search for Patient</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="fas fa-search"></i>
                                            </span>
                                            <input type="text" class="form-control" id="patientSearch" 
                                                   th:placeholder="#{appointment.patient.search.placeholder}" 
                                                   oninput="searchPatients(this.value)">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label" th:text="#{appointment.or}">Or</label>
                                        <button type="button" class="btn btn-outline-primary w-100" onclick="showNewPatientForm()">
                                            <i class="fas fa-user-plus me-2"></i><span th:text="#{appointment.add.new.patient}">Add New Patient</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Patient Search Results -->
                                <div id="patientResults" class="search-results mt-3" style="display: none;">
                                    <!-- Results will be populated by JavaScript -->
                                </div>

                                <!-- Selected Patient Display -->
                                <div id="selectedPatient" class="mt-3" style="display: none;">
                                    <div class="alert alert-success">
                                        <div class="d-flex align-items-center">
                                            <div class="patient-avatar me-3">
                                                <span id="selectedPatientInitial">J</span>
                                            </div>
                                            <div>
                                                <h6 class="mb-1" id="selectedPatientName">John Smith</h6>
                                                <small class="text-muted">
                                                    ID: <span id="selectedPatientId">#12345</span> | 
                                                    Phone: <span id="selectedPatientPhone">(555) 123-4567</span>
                                                </small>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-danger ms-auto" onclick="clearSelectedPatient()">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end mt-4">
                                    <button type="button" class="btn btn-primary" onclick="nextStep(2)" id="nextToStep2" disabled>
                                        <span th:text="#{appointment.next.date.time}">Next: Date & Time</span> <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 2: Date & Time Selection -->
                            <div id="datetimeStep" class="form-step" style="display: none;">
                                <h4 class="section-header">
                                    <i class="fas fa-calendar-alt me-2"></i><span th:text="#{appointment.select.date.time}">Select Date & Time</span>
                                </h4>

                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="appointmentDate" class="form-label" th:text="#{appointment.appointment.date}">Appointment Date</label>
                                        <input type="date" class="form-control" id="appointmentDate" 
                                               onchange="loadAvailableSlots()" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="duration" class="form-label" th:text="#{appointment.duration}">Duration</label>
                                        <select class="form-select" id="duration" onchange="loadAvailableSlots()">
                                            <option value="30">30 minutes</option>
                                            <option value="45">45 minutes</option>
                                            <option value="60">60 minutes</option>
                                            <option value="90">90 minutes</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Available Time Slots -->
                                <div class="mt-4">
                                    <label class="form-label" th:text="#{appointment.available.time.slots}">Available Time Slots</label>
                                    <div id="timeSlots" class="row">
                                        <!-- Time slots will be populated by JavaScript -->
                                        <div class="col-12 text-center text-muted py-4">
                                            <i class="fas fa-clock fa-2x mb-2"></i>
                                            <p th:text="#{appointment.select.date.view.slots}">Please select a date to view available time slots</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="previousStep(1)">
                                        <i class="fas fa-arrow-left me-2"></i><span th:text="#{common.back}">Back</span>
                                    </button>
                                    <button type="button" class="btn btn-primary" onclick="nextStep(3)" id="nextToStep3" disabled>
                                        <span th:text="#{appointment.next.details}">Next: Details</span> <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 3: Appointment Details -->
                            <div id="detailsStep" class="form-step" style="display: none;">
                                <h4 class="section-header">
                                    <i class="fas fa-clipboard-list me-2"></i><span th:text="#{appointment.appointment.details}">Appointment Details</span>
                                </h4>

                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="appointmentType" class="form-label" th:text="#{appointment.appointment.type}">Appointment Type</label>
                                        <select class="form-select" id="appointmentType" required>
                                            <option value="">Select type...</option>
                                            <option value="General Consultation">General Consultation</option>
                                            <option value="Follow-up">Follow-up</option>
                                            <option value="Annual Checkup">Annual Checkup</option>
                                            <option value="Specialist Consultation">Specialist Consultation</option>
                                            <option value="Emergency">Emergency</option>
                                            <option value="Vaccination">Vaccination</option>
                                            <option value="Lab Results Review">Lab Results Review</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="priority" class="form-label" th:text="#{appointment.priority.level}">Priority Level</label>
                                        <select class="form-select" id="priority">
                                            <option value="Normal">Normal</option>
                                            <option value="High">High</option>
                                            <option value="Urgent">Urgent</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-12">
                                        <label for="notes" class="form-label" th:text="#{appointment.notes}">Notes</label>
                                        <textarea class="form-control" id="notes" rows="4" 
                                                  placeholder="Enter any additional notes or special instructions for this appointment..."></textarea>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="sendReminder" checked>
                                            <label class="form-check-label" for="sendReminder" th:text="#{appointment.send.reminder.notification}">
                                                Send reminder notification to patient
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="requirePrep">
                                            <label class="form-check-label" for="requirePrep" th:text="#{appointment.patient.preparation.required}">
                                                Patient preparation required
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="previousStep(2)">
                                        <i class="fas fa-arrow-left me-2"></i><span th:text="#{common.back}">Back</span>
                                    </button>
                                    <button type="button" class="btn btn-primary" onclick="nextStep(4)">
                                        <span th:text="#{appointment.next.review}">Next: Review</span> <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 4: Confirmation -->
                            <div id="confirmationStep" class="form-step" style="display: none;">
                                <h4 class="section-header">
                                    <i class="fas fa-check-circle me-2"></i><span th:text="#{appointment.confirm.appointment}">Confirm Appointment</span>
                                </h4>

                                <div class="card" style="border: 2px solid var(--success-color); border-radius: 15px;">
                                    <div class="card-body">
                                        <h5 class="text-success mb-3">
                                            <i class="fas fa-calendar-check me-2"></i><span th:text="#{appointment.appointment.summary}">Appointment Summary</span>
                                        </h5>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6 th:text="#{appointment.patient.information}">Patient Information</h6>
                                                <p class="mb-1"><strong>Name:</strong> <span id="confirmPatientName">-</span></p>
                                                <p class="mb-1"><strong>ID:</strong> <span id="confirmPatientId">-</span></p>
                                                <p class="mb-3"><strong>Phone:</strong> <span id="confirmPatientPhone">-</span></p>
                                            </div>
                                            <div class="col-md-6">
                                                <h6 th:text="#{appointment.appointment.details}">Appointment Details</h6>
                                                <p class="mb-1"><strong>Date:</strong> <span id="confirmDate">-</span></p>
                                                <p class="mb-1"><strong>Time:</strong> <span id="confirmTime">-</span></p>
                                                <p class="mb-1"><strong>Duration:</strong> <span id="confirmDuration">-</span> minutes</p>
                                                <p class="mb-3"><strong>Type:</strong> <span id="confirmType">-</span></p>
                                            </div>
                                        </div>
                                        
                                        <div id="confirmNotesSection" style="display: none;">
                                                                                            <h6 th:text="#{appointment.notes}">Notes</h6>
                                            <p class="text-muted" id="confirmNotes">-</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="previousStep(3)">
                                        <i class="fas fa-arrow-left me-2"></i><span th:text="#{common.back}">Back</span>
                                    </button>
                                    <button type="submit" class="btn btn-success" onclick="scheduleAppointment()">
                                        <i class="fas fa-calendar-check me-2"></i><span th:text="#{appointment.schedule.appointment}">Schedule Appointment</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedPatient = null;
        let selectedTimeSlot = null;
        let currentStep = 1;

        // Sample patient data for demo
        const samplePatients = [
            { id: 1, firstName: 'John', lastName: 'Smith', phone: '(555) 123-4567', email: 'john.smith@email.com' },
            { id: 2, firstName: 'Mary', lastName: 'Johnson', phone: '(555) 234-5678', email: 'mary.johnson@email.com' },
            { id: 3, firstName: 'Robert', lastName: 'Brown', phone: '(555) 345-6789', email: 'robert.brown@email.com' },
            { id: 4, firstName: 'Sarah', lastName: 'Davis', phone: '(555) 456-7890', email: 'sarah.davis@email.com' },
            { id: 5, firstName: 'Michael', lastName: 'Wilson', phone: '(555) 567-8901', email: 'michael.wilson@email.com' }
        ];

        // Sample time slots for demo
        const sampleTimeSlots = [
            { time: '09:00', available: true },
            { time: '09:30', available: true },
            { time: '10:00', available: false },
            { time: '10:30', available: true },
            { time: '11:00', available: true },
            { time: '11:30', available: false },
            { time: '14:00', available: true },
            { time: '14:30', available: true },
            { time: '15:00', available: true },
            { time: '15:30', available: false },
            { time: '16:00', available: true },
            { time: '16:30', available: true }
        ];

        // Search patients
        function searchPatients(query) {
            const resultsContainer = document.getElementById('patientResults');
            
            if (query.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }

            const filteredPatients = samplePatients.filter(patient => 
                patient.firstName.toLowerCase().includes(query.toLowerCase()) ||
                patient.lastName.toLowerCase().includes(query.toLowerCase()) ||
                patient.phone.includes(query) ||
                patient.id.toString().includes(query)
            );

            if (filteredPatients.length > 0) {
                resultsContainer.innerHTML = filteredPatients.map(patient => `
                    <div class="patient-search-card card" onclick="selectPatient(${patient.id})">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center">
                                <div class="patient-avatar me-3">
                                    <span>${patient.firstName.charAt(0)}</span>
                                </div>
                                <div>
                                    <h6 class="mb-1">${patient.firstName} ${patient.lastName}</h6>
                                    <small class="text-muted">
                                        ID: #${patient.id} | ${patient.phone}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                resultsContainer.style.display = 'block';
            } else {
                resultsContainer.innerHTML = `
                    <div class="text-center p-3 text-muted">
                        <i class="fas fa-search fa-2x mb-2"></i>
                        <p>No patients found matching "${query}"</p>
                    </div>
                `;
                resultsContainer.style.display = 'block';
            }
        }

        // Select patient
        function selectPatient(patientId) {
            selectedPatient = samplePatients.find(p => p.id === patientId);
            
            document.getElementById('selectedPatientInitial').textContent = selectedPatient.firstName.charAt(0);
            document.getElementById('selectedPatientName').textContent = `${selectedPatient.firstName} ${selectedPatient.lastName}`;
            document.getElementById('selectedPatientId').textContent = `#${selectedPatient.id}`;
            document.getElementById('selectedPatientPhone').textContent = selectedPatient.phone;
            
            document.getElementById('selectedPatient').style.display = 'block';
            document.getElementById('patientResults').style.display = 'none';
            document.getElementById('patientSearch').value = '';
            document.getElementById('nextToStep2').disabled = false;
        }

        // Clear selected patient
        function clearSelectedPatient() {
            selectedPatient = null;
            document.getElementById('selectedPatient').style.display = 'none';
            document.getElementById('nextToStep2').disabled = true;
        }

        // Show new patient form
        function showNewPatientForm() {
            alert('New patient registration form would open here. For demo purposes, please select from existing patients.');
        }

        // Load available time slots
        function loadAvailableSlots() {
            const date = document.getElementById('appointmentDate').value;
            const duration = document.getElementById('duration').value;
            const slotsContainer = document.getElementById('timeSlots');

            if (!date) {
                slotsContainer.innerHTML = `
                    <div class="col-12 text-center text-muted py-4">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <p>Please select a date to view available time slots</p>
                    </div>
                `;
                return;
            }

            slotsContainer.innerHTML = sampleTimeSlots.map(slot => `
                <div class="col-md-3 col-sm-4 col-6">
                    <div class="time-slot ${slot.available ? '' : 'unavailable'}" 
                         onclick="${slot.available ? `selectTimeSlot('${slot.time}')` : ''}"
                         data-time="${slot.time}">
                        <strong>${formatTime(slot.time)}</strong>
                        <br>
                        <small>${slot.available ? 'Available' : 'Booked'}</small>
                    </div>
                </div>
            `).join('');
        }

        // Select time slot
        function selectTimeSlot(time) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            document.querySelector(`[data-time="${time}"]`).classList.add('selected');
            selectedTimeSlot = time;
            document.getElementById('nextToStep3').disabled = false;
        }

        // Format time for display
        function formatTime(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Step navigation
        function nextStep(step) {
            // Hide current step
            document.querySelectorAll('.form-step').forEach(s => s.style.display = 'none');
            
            // Update step indicators
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            
            // Mark previous steps as completed
            for (let i = 1; i < step; i++) {
                document.getElementById(`step${i}`).classList.add('completed');
            }
            
            currentStep = step;
            
            // Show target step
            if (step === 2) {
                document.getElementById('datetimeStep').style.display = 'block';
                // Set minimum date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('appointmentDate').min = today;
            } else if (step === 3) {
                document.getElementById('detailsStep').style.display = 'block';
            } else if (step === 4) {
                document.getElementById('confirmationStep').style.display = 'block';
                populateConfirmation();
            }
        }

        function previousStep(step) {
            // Hide current step
            document.querySelectorAll('.form-step').forEach(s => s.style.display = 'none');
            
            // Update step indicators
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            
            // Remove completed status from future steps
            for (let i = step + 1; i <= 4; i++) {
                document.getElementById(`step${i}`).classList.remove('completed');
            }
            
            currentStep = step;
            
            // Show target step
            if (step === 1) {
                document.getElementById('patientStep').style.display = 'block';
            } else if (step === 2) {
                document.getElementById('datetimeStep').style.display = 'block';
            } else if (step === 3) {
                document.getElementById('detailsStep').style.display = 'block';
            }
        }

        // Populate confirmation step
        function populateConfirmation() {
            if (selectedPatient) {
                document.getElementById('confirmPatientName').textContent = `${selectedPatient.firstName} ${selectedPatient.lastName}`;
                document.getElementById('confirmPatientId').textContent = `#${selectedPatient.id}`;
                document.getElementById('confirmPatientPhone').textContent = selectedPatient.phone;
            }

            const date = document.getElementById('appointmentDate').value;
            if (date) {
                const dateObj = new Date(date);
                document.getElementById('confirmDate').textContent = dateObj.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            if (selectedTimeSlot) {
                document.getElementById('confirmTime').textContent = formatTime(selectedTimeSlot);
            }

            document.getElementById('confirmDuration').textContent = document.getElementById('duration').value;
            document.getElementById('confirmType').textContent = document.getElementById('appointmentType').value;

            const notes = document.getElementById('notes').value;
            if (notes.trim()) {
                document.getElementById('confirmNotes').textContent = notes;
                document.getElementById('confirmNotesSection').style.display = 'block';
            } else {
                document.getElementById('confirmNotesSection').style.display = 'none';
            }
        }

        // Schedule appointment
        function scheduleAppointment() {
            // In real implementation, this would send data to the server
            const appointmentData = {
                patientId: selectedPatient.id,
                date: document.getElementById('appointmentDate').value,
                time: selectedTimeSlot,
                duration: document.getElementById('duration').value,
                type: document.getElementById('appointmentType').value,
                priority: document.getElementById('priority').value,
                notes: document.getElementById('notes').value,
                sendReminder: document.getElementById('sendReminder').checked,
                requirePrep: document.getElementById('requirePrep').checked
            };

            console.log('Scheduling appointment:', appointmentData);

            // Show success message
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show';
            const successText = document.body.getAttribute('data-success-text') || 'Success!';
            const scheduledText = document.body.getAttribute('data-scheduled-text') || 'Appointment has been scheduled successfully.';
            successAlert.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>
                <strong>${successText}</strong> ${scheduledText}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            const cardBody = document.querySelector('#confirmationStep .card-body');
            cardBody.insertBefore(successAlert, cardBody.firstChild);

            // Redirect after a short delay
            setTimeout(() => {
                window.location.href = '/doctor-appointments';
            }, 2000);
        }

        // Add interactivity to sidebar items
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function() {
                if (!this.classList.contains('active')) {
                    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').min = today;
            
            // Add form validation
            document.getElementById('appointmentType').addEventListener('change', function() {
                // Enable next button if form is valid for step 3
                // Add validation logic here
            });
        });

        // Add smooth animations for card interactions
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        document.querySelectorAll('.patient-search-card').forEach(card => {
                            card.addEventListener('mouseenter', function() {
                                this.style.boxShadow = '0 6px 12px rgba(0,0,0,0.15)';
                            });
                            
                            card.addEventListener('mouseleave', function() {
                                this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                            });
                        });
                    }
                });
            });
            
            observer.observe(document.getElementById('patientResults'), {
                childList: true,
                subtree: true
            });
        });
    </script>
</body>
</html>