<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="#{register.doctor.title}">Doctor Registration - Healthcare Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 50%, #f5f5ff 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 2.2rem;
            font-weight: 600;
            position: relative;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #2e7d32, #1976d2);
            border-radius: 2px;
        }

        .section-title {
            color: #2e7d32;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 30px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #e8f5e8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2e7d32;
            background: white;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
            transform: translateY(-1px);
        }

        input:hover, select:hover, textarea:hover {
            border-color: #cbd5e0;
        }

        select {
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
            appearance: none;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        /* Fixed file upload styles */
        .file-upload {
            position: relative;
            display: block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            left: -9999px;
            opacity: 0;
            z-index: -1;
        }

        .file-upload-btn {
            display: block;
            width: 100%;
            background: #f8fafc;
            border: 2px dashed #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #718096;
            font-size: 1rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .file-upload-btn:hover {
            border-color: #2e7d32;
            background: #e8f5e8;
            color: #2e7d32;
            transform: translateY(-1px);
        }

        .file-upload-btn.has-file {
            border-color: #48bb78;
            background: #e6ffed;
            color: #2e7d32;
        }

        .file-info {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 5px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #2e7d32 0%, #1976d2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 125, 50, 0.3);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        /* Input validation styles */
        input:required:invalid {
            border-color: #fed7d7;
        }

        input:required:valid {
            border-color: #c6f6d5;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
                max-width: 95%;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            h1 {
                font-size: 1.8rem;
            }
        }

        /* Loading state */
        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: #e53e3e;
            font-size: 0.8rem;
            margin-top: 4px;
            display: none;
        }

        /* Privacy notice */
        .privacy-notice {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        /* Success message */
        .success-message {
            background: #e6ffed; 
            border-left: 5px solid #38a169; 
            padding: 15px; 
            margin-bottom: 20px;
            border-radius: 5px;
        }
          .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #495057, #6c757d);
        }
    </style>
</head>
<body>
    <div style="position: absolute; top: 20px; right: 20px; z-index: 1000;">
        <div th:replace="~{fragments/language-selector :: language-selector}"></div>
    </div>
    
    <a href="/" class="back-btn" th:text="#{common.back}">← Back to Home</a>
    <div class="container">
        <h1 th:text="#{register.doctor.title}">Doctor Registration</h1>
        
        <div class="privacy-notice">
            <strong th:text="#{register.privacy.notice} + ':'">Privacy Notice:</strong> <span th:text="#{register.privacy.description}">Your personal and professional information will be kept secure and used only for purposes related to your medical practice on this platform. 
            This includes verifying your credentials, enabling patient communication, and complying with applicable healthcare regulations. 
            We do not share your information with third parties without your consent.</span>
        </div>

        <div 
            th:if="${successMessage}" 
            class="success-message"
            id="successMessage"
          >
            ✅ <span th:text="${successMessage}">Doctor registered successfully!</span>
          </div>
        
        <form action="/registerdoc" method="post" enctype="multipart/form-data" novalidate>
            
            <!-- Personal Information Section -->
            <div class="section-title" th:text="#{register.personal.information}">Personal Information</div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="firstName" th:text="#{register.firstname}">First Name *</label>
                    <input type="text" id="firstName" name="firstName" required 
                           pattern="[A-Za-z\s]+" title="Please enter a valid first name" />
                    <span class="error-message">Please enter your first name</span>
                </div>
                
                <div class="form-group">
                    <label for="lastName" th:text="#{register.lastname}">Last Name *</label>
                    <input type="text" id="lastName" name="lastName" required 
                           pattern="[A-Za-z\s]+" title="Please enter a valid last name" />
                    <span class="error-message">Please enter your last name</span>
                </div>
                
                <div class="form-group">
                    <label for="email" th:text="#{register.email}">Email Address *</label>
                    <input type="email" id="email" name="email" required 
                           th:placeholder="#{register.email.placeholder}" />
                    <span class="error-message" th:text="#{register.email.error}">Please enter a valid email address</span>
                </div>
                
                <div class="form-group">
                    <label for="phoneNumber" th:text="#{register.phone}">Phone Number *</label>
                    <input type="tel" id="phoneNumber" name="phoneNumber" required 
                           th:placeholder="#{register.phone.placeholder}" />
                    <span class="error-message" th:text="#{register.phone.error}">Please enter your phone number</span>
                </div>

                <div class="form-group">
                    <label for="password" th:text="#{register.password}">Password *</label>
                    <input type="password" id="password" name="password" required 
                           minlength="8" th:placeholder="#{register.password.placeholder}" />
                    <span class="error-message" th:text="#{register.password.error}">Password must be at least 8 characters</span>
                </div>

                <div class="form-group">
                    <label for="confirmPassword" th:text="#{register.confirm.password}">Confirm Password *</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required 
                           minlength="8" th:placeholder="#{register.confirm.password.placeholder}" />
                    <span class="error-message" th:text="#{register.confirm.password.error}">Passwords do not match</span>
                </div>
            </div>

            <!-- Address Information Section -->
            <div class="section-title" th:text="#{register.address.information}">Address Information</div>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="streetAddress" th:text="#{register.street.address}">Street Address *</label>
                    <input type="text" id="streetAddress" name="streetAddress" required 
                           th:placeholder="#{register.street.address.placeholder}" />
                    <span class="error-message" th:text="#{register.street.address.error}">Please enter your street address</span>
                </div>

                <div class="form-group">
                    <label for="city" th:text="#{register.city}">City *</label>
                    <input type="text" id="city" name="city" required 
                           th:placeholder="#{register.city.placeholder}" />
                    <span class="error-message" th:text="#{register.city.error}">Please enter your city</span>
                </div>

                <div class="form-group">
                    <label for="postalCode" th:text="#{register.postal.code}">Postal Code</label>
                    <input type="text" id="postalCode" name="postalCode" 
                           th:placeholder="#{register.postal.code.placeholder}" />
                </div>

                <div class="form-group">
                    <label for="country" th:text="#{register.country}">Country *</label>
                    <select id="country" name="country" required>
                        <option value="" th:text="#{register.select.country}">Select Country</option>
                        <option value="Lebanon" th:text="#{register.lebanon}">Lebanon</option>
                        <option value="Syria" th:text="#{register.syria}">Syria</option>
                        <option value="Jordan" th:text="#{register.jordan}">Jordan</option>
                        <option value="Other" th:text="#{register.other}">Other</option>
                    </select>
                    <span class="error-message" th:text="#{register.country.error}">Please select your country</span>
                </div>

                <div class="form-group">
                    <label for="location" th:text="#{register.practice.location}">Practice Location *</label>
                    <input type="text" id="location" name="location" required  
                           th:placeholder="#{register.practice.location.placeholder}" />
                    <span class="error-message" th:text="#{register.practice.location.error}">Please enter your practice location</span>
                </div>
            </div>

            <!-- Professional Information Section -->
            <div class="section-title" th:text="#{register.professional.information}">Professional Information</div>
            <div class="form-grid">
              <div class="form-group">
            <label for="specialty" th:text="#{register.specialty}">Specialty *</label>
            <select name="specialty.id" id="specialty" required>
                <option value="" th:text="#{register.select.specialty}">-- Select Specialty --</option>
                <!-- Replace hard-coded options with dynamic ones -->
                <option th:each="specialty : ${specialties}" 
                        th:value="${specialty.id}" 
                        th:text="${specialty.name}">
                </option>
            </select>
                <span class="error-message" th:text="#{register.specialty.error}">Please select your specialty</span>
             </div>
                <div class="form-group">
                    <label for="experience" th:text="#{register.experience}">Experience (Years) *</label>
                    <input type="number" id="experience" name="experience" required 
                           min="0" max="50" title="Please enter your experience" />
                    <span class="error-message" th:text="#{register.experience.error}">Please enter your experience</span>
                </div>

                <div class="form-group">
                    <label for="medicalSchool" th:text="#{register.medical.school}">Medical School *</label>
                    <input type="text" id="medicalSchool" name="medicalSchool" required 
                           th:placeholder="#{register.medical.school.placeholder}" />
                    <span class="error-message" th:text="#{register.medical.school.error}">Please enter your medical school</span>
                </div>

                <div class="form-group">
                    <label for="graduationYear" th:text="#{register.graduation.year}">Graduation Year *</label>
                    <input type="number" id="graduationYear" name="graduationYear" required 
                           min="1950" max="2024" th:placeholder="#{register.graduation.year.placeholder}" />
                    <span class="error-message" th:text="#{register.graduation.year.error}">Please enter your graduation year</span>
                </div>

                <div class="form-group">
                    <label for="licenseNumber" th:text="#{register.license.number}">Medical License Number *</label>
                    <input type="text" id="licenseNumber" name="licenseNumber" required 
                           th:placeholder="#{register.license.number.placeholder}" />
                    <span class="error-message" th:text="#{register.license.number.error}">Please enter your license number</span>
                </div>

                <div class="form-group">
                    <label for="licenseExpiryDate" th:text="#{register.license.expiry.date}">License Expiry Date *</label>
                    <input type="date" id="licenseExpiryDate" name="licenseExpiryDate" required />
                    <span class="error-message" th:text="#{register.license.expiry.date.error}">Please enter your license expiry date</span>
                </div>

                <div class="form-group full-width">
                    <label for="hospitalAffiliations" th:text="#{register.hospital.affiliations}">Hospital Affiliations</label>
                    <input type="text" id="hospitalAffiliations" name="hospitalAffiliations" 
                           th:placeholder="#{register.hospital.affiliations.placeholder}" />
                </div>

                <div class="form-group full-width">
                    <label for="boardCertifications" th:text="#{register.board.certifications}">Board Certifications</label>
                    <input type="text" id="boardCertifications" name="boardCertifications" 
                           th:placeholder="#{register.board.certifications.placeholder}" />
                </div>
            </div>

            <!-- Practice Information Section -->
            <div class="section-title" th:text="#{register.practice.information}">Practice Information</div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="consultationFee" th:text="#{register.consultation.fee}">Consultation Fee (USD) *</label>
                    <input type="number" id="consultationFee" name="consultationFee" required 
                           min="0" step="0.01" th:placeholder="#{register.consultation.fee.placeholder}" />
                    <span class="error-message" th:text="#{register.consultation.fee.error}">Please enter your consultation fee</span>
                </div>

                <div class="form-group">
                    <label for="workingDays" th:text="#{register.working.days}">Working Days *</label>
                    <select id="workingDays" name="workingDays" required>
                        <option value="" th:text="#{register.select.working.days}">Select Working Days</option>
                        <option value="Monday to Friday" th:text="#{register.monday.to.friday}">Monday to Friday</option>
                        <option value="Monday to Saturday" th:text="#{register.monday.to.saturday}">Monday to Saturday</option>
                        <option value="Sunday to Thursday" th:text="#{register.sunday.to.thursday}">Sunday to Thursday</option>
                        <option value="Custom Schedule" th:text="#{register.custom.schedule}">Custom Schedule</option>
                    </select>
                    <span class="error-message" th:text="#{register.working.days.error}">Please select your working days</span>
                </div>

                <div class="form-group">
                    <label for="startTime" th:text="#{register.start.time}">Start Time *</label>
                    <input type="time" id="startTime" name="startTime" required />
                    <span class="error-message" th:text="#{register.start.time.error}">Please enter your start time</span>
                </div>

                <div class="form-group">
                    <label for="endTime" th:text="#{register.end.time}">End Time *</label>
                    <input type="time" id="endTime" name="endTime" required />
                    <span class="error-message" th:text="#{register.end.time.error}">Please enter your end time</span>
                </div>

                <div class="form-group full-width">
                    <label for="biography" th:text="#{register.professional.biography}">Professional Biography</label>
                    <textarea id="biography" name="biography" 
                              th:placeholder="#{register.professional.biography.placeholder}"></textarea>
                </div>
            </div>

            <!-- Document Upload Section -->
            <div class="section-title" th:text="#{register.document.upload}">Document Upload</div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="profilePhoto" th:text="#{register.profile.photo}">Profile Photo</label>
                    <div class="file-upload">
                        <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*" />
                        <div class="file-upload-btn" id="profilePhotoBtn">
                            <div th:text="#{register.upload.profile.photo}">📷 Upload Profile Photo</div>
                            <div class="file-info" th:text="#{register.profile.photo.info}">JPG, PNG max 5MB</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="licenseDocument" th:text="#{register.license.document}">Medical License Document *</label>
                    <div class="file-upload">
                        <input type="file" id="licenseDocument" name="licenseDocument" accept=".pdf,.jpg,.jpeg,.png" required />
                        <div class="file-upload-btn" id="licenseDocumentBtn">
                            <div th:text="#{register.upload.license.document}">📄 Upload License Document</div>
                            <div class="file-info" th:text="#{register.license.document.info}">PDF, JPG, PNG max 10MB</div>
                        </div>
                    </div>
                    <span class="error-message" th:text="#{register.license.document.error}">Please upload your medical license</span>
                </div>
            </div>
            
            <button type="submit" class="submit-btn" th:text="#{register.submit}">
                Register Doctor
            </button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const submitBtn = document.querySelector('.submit-btn');
            
            // File upload handlers
            function setupFileUpload(inputId, btnId) {
                const input = document.getElementById(inputId);
                const btn = document.getElementById(btnId);
                
                // Click handler for the button
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    input.click();
                });
                
                // Change handler for the input
                input.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        const file = this.files[0];
                        btn.classList.add('has-file');
                        
                        if (inputId === 'profilePhoto') {
                            btn.innerHTML = `
                                <div>✅ ${file.name}</div>
                                <div class="file-info">Click to change</div>
                            `;
                        } else {
                            btn.innerHTML = `
                                <div>✅ ${file.name}</div>
                                <div class="file-info">Click to change</div>
                            `;
                            // Hide error message for required license document
                            const errorMsg = this.closest('.form-group').querySelector('.error-message');
                            if (errorMsg) {
                                errorMsg.style.display = 'none';
                            }
                        }
                    } else {
                        btn.classList.remove('has-file');
                        if (inputId === 'profilePhoto') {
                            btn.innerHTML = `
                                <div>📷 Upload Profile Photo</div>
                                <div class="file-info">JPG, PNG max 5MB</div>
                            `;
                        } else {
                            btn.innerHTML = `
                                <div>📄 Upload License Document</div>
                                <div class="file-info">PDF, JPG, PNG max 10MB</div>
                            `;
                        }
                    }
                });
            }
            
            // Initialize file uploads
            setupFileUpload('profilePhoto', 'profilePhotoBtn');
            setupFileUpload('licenseDocument', 'licenseDocumentBtn');
            
            // Real-time validation
            const inputs = document.querySelectorAll('input[required], select[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', validateField);
                input.addEventListener('input', clearError);
            });
            
            function validateField(e) {
                const field = e.target;
                const errorMsg = field.parentNode.querySelector('.error-message');
                
                if (!field.checkValidity()) {
                    field.style.borderColor = '#e53e3e';
                    if (errorMsg) {
                        errorMsg.style.display = 'block';
                    }
                } else {
                    field.style.borderColor = '#48bb78';
                    if (errorMsg) {
                        errorMsg.style.display = 'none';
                    }
                }
            }
            
            function clearError(e) {
                const field = e.target;
                const errorMsg = field.parentNode.querySelector('.error-message');
                
                if (field.checkValidity()) {
                    field.style.borderColor = '#e2e8f0';
                    if (errorMsg) {
                        errorMsg.style.display = 'none';
                    }
                }
            }
            
            // Password confirmation validation
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirmPassword');
            
            confirmPassword.addEventListener('blur', function() {
                const errorMsg = this.parentNode.querySelector('.error-message');
                if (this.value !== password.value) {
                    this.style.borderColor = '#e53e3e';
                    if (errorMsg) {
                        errorMsg.style.display = 'block';
                    }
                } else {
                    this.style.borderColor = '#48bb78';
                    if (errorMsg) {
                        errorMsg.style.display = 'none';
                    }
                }
            });
            
            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Check password confirmation
                if (password.value !== confirmPassword.value) {
                    confirmPassword.focus();
                    validateField({ target: confirmPassword });
                    return;
                }
                
                // Validate all required fields
                let isValid = true;
                inputs.forEach(input => {
                    if (!input.checkValidity()) {
                        isValid = false;
                        validateField({ target: input });
                    }
                });
                
                // Check file uploads
                const licenseDoc = document.getElementById('licenseDocument');
                if (!licenseDoc.files.length) {
                    isValid = false;
                    const errorMsg = licenseDoc.closest('.form-group').querySelector('.error-message');
                    if (errorMsg) {
                        errorMsg.style.display = 'block';
                    }
                }
                
                if (isValid) {
                   
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Registering...';
                  form.submit();
                } else {
                    // Scroll to first error
                    const firstError = document.querySelector('input:invalid, select:invalid');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        firstError.focus();
                    }
                }
            });
            
            // Phone number formatting
            const phoneInput = document.getElementById('phoneNumber');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                // Format for Lebanese numbers
                if (value.startsWith('961')) {
                    value = value.replace(/(\d{3})(\d{2})(\d{3})(\d{3})/, '+$1 $2 $3 $4');
                } else if (value.length >= 6) {
                    value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 3) {
                    value = value.replace(/(\d{3})(\d{0,3})/, '($1) $2');
                }
                e.target.value = value;
            });

            // Time validation
            const startTime = document.getElementById('startTime');
            const endTime = document.getElementById('endTime');
            
            endTime.addEventListener('change', function() {
                if (startTime.value && endTime.value && startTime.value >= endTime.value) {
                    alert('End time must be after start time');
                    this.value = '';
                }
            });
        });
    </script>
</body>
</html>